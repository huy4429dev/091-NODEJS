<style>
  .select-pure__select {
    align-items: center;
    background: #f9f9f8;
    border-radius: 4px;
    border: 1px solid rgba(0, 0, 0, 0.15);
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.04);
    box-sizing: border-box;
    color: #363b3e;
    cursor: pointer;
    display: flex;
    font-size: 14px;
    font-weight: 400;
    justify-content: left;
    min-height: 44px;
    padding: 5px 10px;
    position: relative;
    transition: 0.2s;
    width: 100%;
  }

  .select-pure__options {
    border-radius: 4px;
    border: 1px solid rgba(0, 0, 0, 0.15);
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.04);
    box-sizing: border-box;
    color: #363b3e;
    display: none;
    left: 0;
    max-height: 221px;
    overflow-y: scroll;
    position: absolute;
    top: 50px;
    width: 100%;
    z-index: 5;
  }

  .select-pure__select--opened .select-pure__options {
    display: block;
  }

  .select-pure__option {
    background: #fff;
    border-bottom: 1px solid #e4e4e4;
    box-sizing: border-box;
    height: 44px;
    line-height: 25px;
    padding: 10px;
  }

  .select-pure__option--disabled {
    color: #e4e4e4;
  }

  .select-pure__option--selected {
    color: #e4e4e4;
    cursor: initial;
    pointer-events: none;
  }

  .select-pure__option--hidden {
    display: none;
  }

  .select-pure__selected-label {
    font-size: 12px;
    align-items: 'center';
    background: teal;
    border-radius: 4px;
    color: #fff;
    cursor: initial;
    display: inline-flex;
    justify-content: 'center';
    margin: 5px 10px 5px 0;
    padding: 3px 7px;
  }

  .select-pure__selected-label:last-of-type {
    margin-right: 0;
  }

  .select-pure__selected-label i {
    cursor: pointer;
    display: inline-block;
    margin-left: 7px;
  }

  .select-pure__selected-label img {
    cursor: pointer;
    display: inline-block;
    height: 18px;
    margin-left: 7px;
    width: 14px;
  }

  .select-pure__selected-label i:hover {
    color: #e4e4e4;
  }

  .select-pure__autocomplete {
    background: #f9f9f8;
    border-bottom: 1px solid #e4e4e4;
    border-left: none;
    border-right: none;
    border-top: none;
    box-sizing: border-box;
    font-size: 16px;
    outline: none;
    padding: 10px;
    width: 100%;
  }

  .select-pure__placeholder--hidden {
    display: none;
  }
</style>
<div class="col">
  <div class="card">
    <!-- Card header -->
    <div class="card-header border-0">
      <h3 class="mb-0">PHÒNG</h3>
    </div>
    <div class="row">
      <div class="col-4">
        <div class="card-body">
          <div>
            <div class="card" data-toggle="modal" data-target="#roomModal"
              style="cursor: pointer; box-shadow: 1px 0px 3px 1px #8080805c">
              <!-- Card body -->
              <div class="card-body">
                <div class="row">
                  <div class="col">
                    <h5 class="card-title text-uppercase text-muted mb-0">VIP</h5>
                    <span class="h2 font-weight-bold mb-0">PC-001</span>
                  </div>
                  <div class="col-auto">
                    <button type="button" class="btn btn-sm btn-warning" data-toggle="tooltip" data-placement="top"
                      title="Trễ thanh toán tiền trọ 1 tháng">
                      Trễ thanh toán
                    </button>
                  </div>
                </div>
                <p class="mt-3 mb-0 text-sm d-flex justify-content-between">
                  <span class="badge badge-pill badge-default" style="border-radius: 0; padding-top: 7px;">đang
                    thuê</span>
                  <span class="text-nowrap text-success" style="font-size: 14px;">1 tháng trước</span>
                </p>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="col-4">
        <div class="card-body">
          <div>
            <div class="card" data-toggle="modal" data-target="#roomModal"
              style="cursor: pointer; box-shadow: 1px 0px 3px 1px #8080805c">
              <!-- Card body -->
              <div class="card-body">
                <div class="row">
                  <div class="col">
                    <h5 class="card-title text-uppercase text-muted mb-0">VIP</h5>
                    <span class="h2 font-weight-bold mb-0">PC-001</span>
                  </div>
                  <div class="col-auto">
                    <button type="button" class="btn btn-sm btn-success" data-toggle="tooltip" data-placement="top"
                      title="Trễ thanh toán tiền trọ 1 tháng">
                      Đã thanh toán
                    </button>
                  </div>
                </div>
                <p class="mt-3 mb-0 text-sm d-flex justify-content-between">
                  <span class="badge badge-pill badge-default" style="border-radius: 0; padding-top: 7px;">
                    phòng trống
                  </span>
                  <span class="text-nowrap text-success" style="font-size: 14px;">1 tháng trước</span>
                </p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <!-- Card footer -->
    <div class="card-footer py-4">
      <nav aria-label="...">
        <ul class="pagination justify-content-end mb-0">
          <% for (i=1; i <=total; i ++) { %>
            <% if(curentPage==i) { %>
              <li class="page-item active">
                <% if (q !='' || filter !='' ) { %>
                  <a class="page-link"
                    href="/admin/room/category/search?q=<%= q.replace(/%/g,'') %>&filterStatus=<%=filter%>&page=<%= i %>">
                    <%= i %>
                  </a>
                  <% } else { %>
                    <a class="page-link" href="/admin/room/category/?page=<%= i %>">
                      <%= i %>
                    </a>
                    <% } %>

              </li>
              <%} else { %>
                <li class="page-item">

                  <% if (q !='' || filter !='' ) { %>
                    <a class="page-link"
                      href="/admin/room/category/search?q=<%= q.replace(/%/g,'') %>&filterStatus=<%=filter%>&page=<%= i %>">
                      <%= i %>
                    </a>
                    <% } else { %>
                      <a class="page-link" href="/admin/room/category/?page=<%= i %>">
                        <%= i %>
                      </a>
                      <% } %>
                </li>
                <%} %>
                  <% } %>
        </ul>
      </nav>
    </div>
  </div>
</div>

<!-- ROOM MODAL -->
<div class="modal fade" id="roomModal" tabindex="-1" role="dialog" aria-labelledby="roomModalLabel" aria-hidden="true">
  <div class="modal-dialog mw-100 modal-dialog-centered" role="document" style="width: 55%;">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="roomModalLabel">PC - 001</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <div class="row">
          <div class="col">
            <h3 class="mb-4">Thông tin phòng</h3>
            <form action="" method="POST">
              <div class="form-group">
                <label for="example-text-input" class="form-control-label">Tiêu đề</label>
                <input name="title" class="form-control" type="text" value="Ở ghép giường tầng Q4 đối diện Bến Nhà Rồng"
                  id="example-text-input">
              </div>
              <div class="form-group">
                <label for="example-text-input" class="form-control-label">Loại phòng</label>
                <select name="categoryId" class="form-control">
                  <option>Phòng trọ</option>
                  <option>Phòng đơn</option>
                </select>
              </div>
              <div class="form-group">
                <label for="example-text-input" class="form-control-label">Giá phòng</label>
                <input name="price" class="form-control" type="text" value="800000" id="example-text-input">
              </div>
              <div class="form-group">
                <label for="example-text-input" class="form-control-label">Diện tích</label>
                <input name="acr" class="form-control" type="text" value="800000" id="example-text-input">
              </div>
              <div class="form-group">
                <label for="example-text-input" class="form-control-label">Tiền cọc</label>
                <input name="desposit" class="form-control" type="text" value="800000" id="example-text-input">
              </div>
              <div class="form-group">
                <label for="example-text-input" class="form-control-label">Sức chứa</label>
                <input name="capacity" class="form-control" type="text" value="3" id="example-text-input">
              </div>
              <div class="form-group">
                <label for="example-text-input" class="form-control-label">Địa chỉ</label>
                <input name="address" class="form-control" type="text"
                  value="Đường Nguyễn Tất Thành, Phường 12, Quận 4, Tp Hồ Chí Minh" id="example-text-input">
              </div>
              <div name="utilities" class="form-group">
                <label for="example-text-input" class="form-control-label">Tiện ích</label>
                <span class="autocomplete-select"></span>
              </div>
              <div class="form-group">
                <label for="example-text-input" class="form-control-label">Thông tin thêm</label>
                <div id="editor"></div>
              </div>
              <div class="form-group">
                <label for="example-text-input" class="form-control-label">Hình ảnh</label>
                <div class="py-3 text-center">
                  <div class="position-relative">
                    <div class="position-absolute" style="
                                top: 50%;
                                left: 50%;
                                transform: translate(-50%,-50%);
                                width: 100px;
                                /* opacity: 0; */
                                cursor: pointer;
                                height: 100%;
                            ">
                      <form class="form-upload h-100 d-block" action="/admin/upload?path=admin" method="POST"
                        enctype="multipart/form-data">
                        <div class="h-100">
                          <input type="file" name="file" style="
                                      display: block;
                                      height: 100%;
                                      width: 100%;
                                      cursor: pointer;
                                      opacity: 0;
                                  ">
                        </div>
                      </form>
                    </div>
                    <div>
                      <i class="fas fa-file-upload ni-3x"></i>
                      <div>
                        <span id="excel-name" style="font-size: 12px" class="text-primary"></span>
                      </div>
                    </div>
                  </div>
                  <h4 class="heading mt-4">Tải lên hình ảnh</h4>
                  <div style="background-color: red;">
                    xx
                  </div>
                </div>
              </div>
            </form>
          </div>
          <div class="col">
            <h3 class="mb-4">Lịch sử đặt phòng</h3>
            <div id="accordion">
              <div>
                <div class="alert alert-success py-2 mb-0" style="border-radius: 0;" role="alert">
                  <div style="cursor: pointer;" data-toggle="collapse" data-target="#collapseOne" aria-expanded="true"
                    aria-controls="collapseOne">
                    DH #001 - 12/12/2021
                  </div>
                </div>
                <div id="collapseOne" class="collapse show" aria-labelledby="headingOne" data-parent="#accordion">
                  <div class="py-1 px-1">
                    <span class="badge badge-pill badge-success mb-1" style="border-radius: 0; padding-top: 7px;">Đã
                      thanh toán</span>
                    <div class="d-flex align-items-center">
                      <i class="fas fa-user" style="width: 25px"></i>
                      <p class="mb-0" style="font-size:14px; color: #8898aa"> Nguyễn Văn Bo</p>
                    </div>
                    <div class="d-flex align-items-center">
                      <i class="fas fa-map-marker-alt" style="width: 25px"></i>
                      <p class="mb-0" style="font-size:14px; color: #8898aa"> Quận Tân Phú , TPHCM</p>
                    </div>
                    <div class="d-flex align-items-center">
                      <i class="fas fa-dollar-sign" style="width: 25px"></i>
                      <P class="mb-0" style="font-size:14px; color: #8898aa"> 160.000 đ</P>
                    </div>
                    <div class="d-flex align-items-center">
                      <i class="fas fa-phone-square-alt" style="width: 25px"></i>
                      <p class="mb-0" style="font-size:14px; color: #8898aa"> 098754321</p>
                    </div>
                  </div>
                </div>
              </div>

            </div>
            <h3 class="mt-4 mb-4">Thông tin chủ phòng</h3>
            <p class="mb-1"> <i class="fas fa-user"></i> Nguyễn Văn Bo</p>
            <h3 class="mt-4 mb-4">Khách hàng đang thuê</h3>
            <p class="mb-1"> <i class="fas fa-user"></i> Nguyễn Văn Bo</p>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Đóng</button>
        <button type="button" class="btn btn-primary">Lưu</button>
      </div>
    </div>
  </div>
</div>

<!-- LỌC -->
<div class="modal fade" id="filterModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
  aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel">Lọc loại phòng</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <form action="/admin/room/category/search" method="GET">
        <div class="modal-body">
          <div>
            <label for="exampleFormControlInput1">Trạng thái</label>
          </div>
          <div class="custom-control custom-radio custom-control-inline">
            <input type="radio" id="customRadioInline1" name="filterStatus" class="custom-control-input" value="1"
              checked>
            <label class="custom-control-label" for="customRadioInline1">Hoạt động</label>
          </div>
          <div class="custom-control custom-radio custom-control-inline">
            <input type="radio" id="customRadioInline2" name="filterStatus" class="custom-control-input" value="2">
            <label class="custom-control-label" for="customRadioInline2">Không hoạt động</label>
          </div>
          <div class="form-group mt-3">
            <div>
              <label for="exampleFormControlInput1">Thời gian</label>
            </div>
            <div class="input-daterange datepicker row align-items-center">
              <div class="col">
                <div class="form-group">
                  <div class="input-group">
                    <div class="input-group-prepend">
                      <span class="input-group-text"><i class="ni ni-calendar-grid-58"></i></span>
                    </div>
                    <input name="startDate" class="form-control" placeholder="Start date" type="text"
                      value="06/18/2020">
                  </div>
                </div>
              </div>
              <div class="col">
                <div class="form-group">
                  <div class="input-group">
                    <div class="input-group-prepend">
                      <span class="input-group-text"><i class="ni ni-calendar-grid-58"></i></span>
                    </div>
                    <input name="endDate" class="form-control" placeholder="End date" type="text" value="06/22/2020">
                  </div>
                </div>
              </div>
            </div>
          </div>
          <input type="hidden" name="q" value="<%= q.replace(/%/g,'') %>">
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-dismiss="modal">Đóng</button>
          <button type="submit" class="btn btn-primary">Lọc</button>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- THÊM -->

<!-- IMPORT EXCEL  -->
<button style="opacity: 0;" type="button" class="btn btn-block btn-warning mb-3" data-toggle="modal"
  data-target="#modal-notification">Notification</button>
<div class="modal fade" id="modal-notification" tabindex="-1" role="dialog" aria-labelledby="modal-notification"
  aria-hidden="true">
  <div class="modal-dialog  modal-dialog-centered modal-" role="document">
    <div class="modal-content ">

      <div class="modal-header">
        <h6 class="modal-title" id="modal-title-notification">Import excel danh sách loại phòng</h6>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">×</span>
        </button>
      </div>

      <div class="modal-body">

        <div class="py-3 text-center">
          <div class="position-relative">
            <div class="position-absolute" style="
                        top: 50%;
                        left: 50%;
                        transform: translate(-50%,-50%);
                        width: 100px;
                        /* opacity: 0; */
                        cursor: pointer;
                        height: 100%;
                    ">
              <form class="form-upload h-100 d-block" action="/admin/upload?path=admin" method="POST"
                enctype="multipart/form-data">
                <div class="h-100">
                  <input type="file" name="file" style="
                              display: block;
                              height: 100%;
                              width: 100%;
                              cursor: pointer;
                              opacity: 0;
                          ">
                </div>
              </form>
            </div>
            <div>
              <i class="fas fa-file-upload ni-3x"></i>
              <div>
                <span id="excel-name" style="font-size: 12px" class="text-primary"></span>
              </div>
            </div>
          </div>
          <h4 class="heading mt-4">Tải lên file Excel</h4>
          <p>Tải xuống file mẫu <a class="text-success" href="/static/assets/uploads/admin/danh-muc.xlsx">click
              vào đây</a></p>
        </div>

      </div>

      <div class="modal-footer">
        <form action="/admin/room/category/excel/import" method="POST">
          <input type="hidden" name="path-excel-import">
          <button type="submit" class="btn btn-white">Lưu</button>
        </form>
        <button type="button" class="btn btn-link text-white ml-auto" data-dismiss="modal">Đóng</button>
      </div>

    </div>
  </div>


  <!-- FILTER  -->

  <!-- CODE JS  -->


  <script>

    // ckeditor
    ClassicEditor
      .create(document.querySelector('#editor'), {
        toolbar: ['heading', '|', 'bold', 'italic', 'link', 'bulletedList', 'numberedList', 'blockQuote'],
        heading: {
          options: [
            { model: 'paragraph', title: 'Paragraph', class: 'ck-heading_paragraph' },
            { model: 'heading1', view: 'h1', title: 'Heading 1', class: 'ck-heading_heading1' },
            { model: 'heading2', view: 'h2', title: 'Heading 2', class: 'ck-heading_heading2' }
          ]
        }
      })
      .catch(error => {
        console.log(error);
      });
    // select option 

    var autocomplete = new SelectPure(".autocomplete-select", {
      options: [
        {
          label: "Điều hòa",
          value: "sp",
        },
        {
          label: "Quạt cháy",
          value: "qc",
        },
        {
          label: "Máy bơm",
          value: "mb",
        },

      ],
      value: ["sp"],
      multiple: true,
      autocomplete: true,
      icon: "fa fa-times",
      onChange: value => { console.log(value); },
      classNames: {
        select: "select-pure__select",
        dropdownShown: "select-pure__select--opened",
        multiselect: "select-pure__select--multiple",
        label: "select-pure__label",
        placeholder: "select-pure__placeholder",
        dropdown: "select-pure__options",
        option: "select-pure__option",
        autocompleteInput: "select-pure__autocomplete",
        selectedLabel: "select-pure__selected-label",
        selectedOption: "select-pure__option--selected",
        placeholderHidden: "select-pure__placeholder--hidden",
        optionHidden: "select-pure__option--hidden",
      }
    });
    var resetAutocomplete = function () {
      autocomplete.reset();
    };


    // DATE PICKER 

    const startDate = document.querySelector('input[name="startDate"]');
    const endDate = document.querySelector('input[name="endDate"]');
    const now = moment().format("DD/MM/yyyy");
    const fromDate = moment().subtract(7, 'days').format("DD/MM/yyyy");
    startDate.value = fromDate;
    endDate.value = now;


    // upload file 

    // let thumbnail = document.querySelector('#post-thumbnail');
    // let inputThumbnail = document.querySelector("input[name='Thumbnail']");
    function uploadFile(file) {

      const inputSelectFile = document.querySelector('.form-upload input[type="file"]');
      const inputPath = document.querySelector('input[name="path-excel-import"]');
      const excelName = document.querySelector('#excel-name');

      inputSelectFile.addEventListener('change', function () {
        var url = "/admin/upload?path=admin";
        var formData = new FormData();
        formData.append("file", inputSelectFile.files[0]);
        fetch(url, {
          method: 'POST',
          body: formData
        })
          .then(response => response.json())
          .then(data => {
            inputPath.value = data.path;
            excelName.innerHTML = data.path.substring(data.path.lastIndexOf("/") + 1);
            // thumbnail.setAttribute("src", data.dbPath);
            // inputThumbnail.value = data.dbPath;
          })
          .catch(err => {
            console.log(err);
          })
      })
    }

    uploadFile();

    // notifycation
    toastr.options = {
      "closeButton": false,
      "debug": false,
      "newestOnTop": true,
      "progressBar": false,
      "positionClass": "toast-top-right",
      "preventDuplicates": false,
      "onclick": null,
      "showDuration": "300",
      "hideDuration": "1000",
      "timeOut": "5000",
      "extendedTimeOut": "1000",
      "showEasing": "swing",
      "hideEasing": "linear",
      "showMethod": "fadeIn",
      "hideMethod": "fadeOut"
    }

    // loading
    const loadingData = document.querySelector('.box-loading.load-data');
    const loadingModal = document.querySelector('.box-loading.load-modal');
    const formPost = document.querySelector('form[method=POST].create-item');
            
              <% if (!errorValidate && !successAlert) { %>
      window.addEventListener('load', onLoading);
            <%}%>

      function onLoading(event) {
        loadingData.style.display = 'flex';
        setTimeout(() => {
          loadingData.style.display = 'none';
        }, 500);
      }

    function onLoadingModal(event) {
      event.preventDefault();
      loadingModal.style.display = 'flex';
      setTimeout(() => {
        loadingModal.style.display = 'none';
        formPost.submit();
      }, 500);
    }

    function reload() {
      window.location.href = "/admin/room/category"
    }

    // EDIT
    let editId = 0;
    let prevDataEdit = null;
    const loadingModalEdit = document.querySelector('#exampleModalEdit .box-loading.load-modal');
    const formEdit = document.querySelector('#exampleModalEdit');
    const inputNameEdit = document.querySelector('#exampleModalEdit input[name=name]');
    const inputStatusEdit = document.querySelector('#exampleModalEdit select[name=status]');
    const optionEdits = document.querySelectorAll('#exampleModalEdit select[name=status] option');
    const optionEditValues = [];

    optionEdits.forEach(item => optionEditValues.push(item.value));

    function editItem(item) {
      if (prevDataEdit?.name != item.name) {
        inputNameEdit.value = item.name;
      }

      indexOptionSelected = optionEditValues.findIndex(o => o == item.status);
      optionEdits[indexOptionSelected].setAttribute('selected', 'selected');

      prevDataEdit = item;
      editId = item.id;

    }

    function updateItem(event) {
      event.preventDefault();
      // get data
      var dataEdit = {
        name: inputNameEdit.value,
        status: inputStatusEdit.value
      };

      // start loading
      loadingModalEdit.style.display = 'flex';
      // call api
      fetch(`/admin/room/category/update/${editId}`, {
        method: 'PUT', // or 'PUT'
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify(dataEdit),
      })
        .then(response => response.json())
        .then(data => {
          if (data.success) {
            setTimeout(() => {
              // end loading

              loadingModalEdit.style.display = 'none';

              // notify

              toastr["success"](data.message);

              // close modal

              $('#exampleModalEdit').modal('hide');

              //  edit content html

              var eleName = document.querySelector(`#item-${editId} td.budget`);
              var eleStatus = document.querySelector(`#item-${editId} span.status .badge`);
              eleName.textContent = data.name;

              if (data.status == 1) {
                eleStatus.className = 'badge badge-success';
                eleStatus.textContent = 'HOẠT ĐỘNG';
              }
              else {
                eleStatus.className = 'badge badge-danger';
                eleStatus.textContent = 'KHÔNG HOẠT ĐỘNG';
              }

            }, 500);

          }
          else {
            console.log('error:', data)
          }
        })
        .catch((error) => {
          console.error('Error:', error);
        })
        .finally(() => {
        })
        ;
      // notify

      // end loading

    }

            

              
           
              <% if (errorValidate) { %>
              const err = '<%= errorValidate %>';
      toastr["error"]("<%= errorValidate %>")

        <%}%>
                  <% if (successAlert) { %>
      toastr["success"]("<%= successAlert %>")
      <%}%>
  </script>